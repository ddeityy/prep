# –°—Ç—Ä–æ–∫–∏

```go
type string struct {
    str unsafe.Pointer // pointer to first byte
	len int
}
```

```go
nil string = ""
```


```go
// for range –ø–æ —Ä—É–Ω–∞–º
string := "–ø—Ä–∏–≤–µ—Ç"
for i, rune := range(string)
```

```
L = 1 –±–∞–π—Ç
–î = 2 –±–∞–π—Ç–∞
Â§ß = 3 –±–∞–π—Ç–∞
üòÄ = 4 –±–∞–π—Ç–∞
```
</br>

–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ–ª-–≤–∞ –±–∞–π—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ **–±–∏—Ç–∞–º** –ø–µ—Ä–≤–æ–≥–æ **–±–∞–π—Ç–∞**

| –ö–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8 |              |          |          |           |
|---------------- |------------- |--------- |--------- |---------- |
| 1 –±–∞–π—Ç          | **0**xxxxxxx |          |          |           |  
| 2 –±–∞–π—Ç–∞         | **110**xxxxx | 10xxxxxx |          |           |
| 3 –±–∞–π—Ç–∞         | **1110**xxxx | 10xxxxxx | 10xxxxxx |           |
| 4 –±–∞–π—Ç–∞         | **11110**xxx | 10xxxxxx | 10xxxxxx | 10xxxxxx  |

</br>

# –°–ª–∞–π—Å—ã

```go
type slice struct {
    // pointer to first element of 
    // the underlying array
    array unsafe.Pointer // nil in nil
    len int              // 0 in nil
    cap int              // 0 in nil
}
```

### –§–æ—Ä–º—É–ª–∞ append
```go
(oldcap + 3 * 256) / 4
```
</br>

# –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
```go
// normal
type iface struct {
    tab  *itab
    data unsafe.Pointer
}

// empty
type eface struct {
    _type *_type
    data  unsafe.Pointer
}

–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–∞ –∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É O(n*m)

type itab struct {
    inter *interfacetype
    _type *_type
    hash  uint32
    _     [4]byte
    fun   [1]uintptr // runtime becomes [n]uintptr
}
```

# –§—É–Ω–∫—Ü–∏–∏ –∏ –≥–æ—Ä—É—Ç–∏–Ω—ã

–û—Ç–¥–µ–ª—å–Ω–∞—è –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è AST –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏.

–ë—é–¥–∂–µ—Ç –∏–Ω–ª–∞–π–Ω–∞ = 80.

```go
### Escape analisys:
    Heap:
        return *x
        interface{}
        var > stack size
    Stack:
        return x
```

### –ö–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≥–æ—Ä—É—Ç–∏–Ω—É?
    safe point - –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä
    finish
    10ms

### –°—Ç–µ–∫–æ–≤—ã–π —Ñ—Ä–µ–π–º:

* –ê—Ä–≥—É–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏
* –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
* –ê–¥—Ä–µ—Å –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏–∏

### –°—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã:

    –ö–æ–≥–¥–∞ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è —Å—Ç–µ–∫ –≥–æ—Ä—É—Ç–∏–Ω—ã:
        –í —Ä–∞–Ω—Ç–∞–π–º–µ —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ–ª–æ–≥–∞ —Ñ—É–Ω–∫—Ü–∏–∏

    –î–æ Go 1.4 - Split Stack:
        –í—ã–¥–µ–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —Å—Ç–µ–∫ –∏ –≥–æ—Ä—É—Ç–∏–Ω–∞ –ø—Ä—ã–≥–∞–µ—Ç –º–µ–∂–¥—É —Å—Ç–∞—Ä—ã–º –∏ –Ω–æ–≤—ã–º
    –ü–æ—Å–ª–µ - Contiguous Stack:
        –í—ã–¥–µ–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —Å—Ç–µ–∫ (–±–æ–ª—å—à–µ –∏–ª–∏ –º–µ–Ω—å—à–µ)
        –í –≥–æ—Ä—É—Ç–∏–Ω–µ —Å—Ç–∞–≤–∏—Ç—Å—è —Ñ–ª–∞–≥ gcopystack
        –ö–æ–ø–∏—Ä—É—é—Ç—Å—è –¥–∞–Ω–Ω—ã–µ
        –ü–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è —É–∫–∞–∑–∞—Ç–µ–ª–∏
        GC —É–¥–∞–ª—è–µ—Ç —Å—Ç–∞—Ä—ã–π —Å—Ç–µ–∫
    
    –†–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ —Ä–∞–Ω—Ç–∞–π–º–µ
    —Ñ–∞–π–ª runtime/proc.go -> newproc(*func)

    –†–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω—ã:
        2kb -> 1gb   (64bit)
        2kb -> 250mb (32bit)
        –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ - 40-100 —Ç–∞–∫—Ç–æ–≤ CPU

    –†–∞–∑–º–µ—Ä —Å—Ç–µ–∫–∞ —Ç—Ä–µ–¥–∞ –û–°:
        1mb -> 8mb   (–ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –±–∏—Ç–Ω–æ—Å—Ç–∏ –∏ —Ç.–¥.)
        –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ - 1000 —Ç–∞–∫—Ç–æ–≤ CPU
    
    –¢–∏–ø—ã –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–æ–≤:
        * Tiny  (< 16 B and no pointers)
        * Small (< 32 kB)
        * Large (> 32 kB)

### –ü—Ä–æ–ª–æ–≥ —Ñ—É–Ω–∫—Ü–∏–∏:

    Function prologue is a few lines of code at the beginning of a function that prepares the stack and registers for use within the function.
    It checks if the stack space needed for the function's local variables exceeds the available stack size.
    If the stack space needed exceeds the available stack size, the runtime.morestack_noctxt function is called to extend the stack

### –•–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π

Hash(func name, args types, return types)

</br>

# Garbage Collector

    –ö–æ–≥–¥–∞ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è GC:
        –ö–∞–∂–¥—ã–µ 2 –º–∏–Ω—É—Ç—ã
        –í—Ä—É—á–Ω—É—é
    
    –ö–∞–∫ —Ä–∞—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –Ω–æ–≤—ã–π –ª–∏–º–∏—Ç —Ö–∏–ø–∞:
        –Ω–æ–≤—ã–π –ª–∏–º–∏—Ç = —Ö–∏–ø + (—Ö–∏–ø + –∫–æ–ª-–≤–æ —á—ë—Ä–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤) * GOGC / 100

</br>

# –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
    
![scheduler](/scheduler.png)

    GoMaxProcs - –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –∫–æ–ª-–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–≤
    –ï—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –≤—ã—à–µ –º–∞–∫—Å –∫–æ–ª-–≤–∞ —è–¥–µ—Ä –û–°,
    —Ç–æ –±—É–¥–µ—Ç –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–º–µ—Å—Ç–æ –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞
    –∏–∑-–∑–∞ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–π —Å–º–µ–Ω—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

    –ú–∞—à–∏–Ω–∞ (–¢—Ä–µ–¥ –û–°) -> –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä (–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≥–æ—Ä—É—Ç–∏–Ω) -> –ì–æ—Ä—É—Ç–∏–Ω—ã

    –ü–æ—Ä—è–¥–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞:
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
        –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–π –æ—á–µ—Ä–µ–¥–∏
        –ü—Ä–æ–≤–µ—Ä–∫–∞ Net Poller (–∫–∞–∂–¥—ã–π 61 —Ç–∏–∫)
        Work Stealing

    
    Processors (GOMAXPROCS):
        Local Queue
    Net Poller:
        –§–∞–π–ª–æ–≤—ã–µ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã




# –ü—Ä–∏–º–∏—Ç–∏–≤—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

* –ö–∞–Ω–∞–ª—ã
* sync.Pool
* sync.WaitGroup
* sync.Atomic
* sync.Mutex
* sync.RWmutex
* sync.Cond

## –ö–∞–Ω–∞–ª—ã

```
"4 –ê–∫—Å–∏–æ–º—ã"
Closed:
    read:  value -> zero value
    write: panic
Nil:
    read:  deadlock
    write: deadlock
```
</br>